<!--
If you want to include any custom html just before </body>, put it in this file.
Or you can delete these file if you don't need it.
-->
<!-- for example, you could include some js libraries:
<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.19.1/vis.js" integrity="sha256-HdIuWBZj4eftihsoDCJoMYjZi6aNVaw7YlUpzKT3ZxI=" crossorigin="anonymous"></script>
-->
  <div>
    <pre id="dataRetrieved"></pre>
  </div>

  <form>
    <button id="updateIframe">update iframe</button>
  </form>

  <script>
    (function () {      
      // The values needed for the iframe to set or update consent
      let referrer = document.location.href;
      let csp_website_id = 'test123123_v3';
      let csp_websites = JSON.stringify(['sbackp.com','sbackp.dk']);
      let consent_exp_days = 180;
      
      // Create the iframe to communicate with.
      let iframe = document.createElement('iframe');
      iframe.src='https://idyllic-kulfi-7c87be.netlify.app/?referrer='+referrer+'&csp_website_id='+csp_website_id+'&csp_websites='+csp_websites+'&consent_exp_days='+consent_exp_days;
      iframe.setAttribute('style','display:none !important;');
      document.body.appendChild(iframe);

      window.addEventListener('message', function (event) {
        // Verify the message's origin before trusting it.
        if (event.origin !== 'https://idyllic-kulfi-7c87be.netlify.app') {
          // Handle message from an evil domain.
          alert('Message event received from bad origin');
        }
        else {
          // Handle message from a valid domain.
          document.getElementById('dataRetrieved').textContent = event.data;
          localStorage.setItem('consent_'+csp_website_id,event.data);
        }
      });

      let updateiframe = document.getElementById('updateIframe');
      updateiframe.addEventListener('click', function(event) {
        event.preventDefault();

        consents_approved = JSON.stringify(['necessary','statistics']);
        consents_denied = JSON.stringify(['marketing','functional']);
        iframe.src = iframe.src + '&consents_approved='+consents_approved+'&consents_denied='+consents_denied;
      })
    })();
  
  </script>
