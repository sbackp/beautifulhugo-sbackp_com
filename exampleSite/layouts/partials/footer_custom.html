<!--
If you want to include any custom html just before </body>, put it in this file.
Or you can delete these file if you don't need it.
-->
<!-- for example, you could include some js libraries:
<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.19.1/vis.js" integrity="sha256-HdIuWBZj4eftihsoDCJoMYjZi6aNVaw7YlUpzKT3ZxI=" crossorigin="anonymous"></script>
-->
  <div>
    <pre id="dataRetrieved"></pre>
  </div>

  <form>
    <button id="updateDeclineAll">updateDeclineAll</button>
    <button id="updateAcceptAll">updateAcceptAll</button>
    <button id="updateSelected">updateSelected</button>
  </form>

  <script>
    (function () {      
    // The values needed for the iframe to set or update consent
    let referrer = document.location.href;
    let csp_website_id = '123123';
    let csp_websites = JSON.stringify(['sbackp.com','sbackp.dk']);
    let consent_exp_days = 180;
    
    // Create the iframe to communicate with.
    let iframe = document.createElement('iframe');
    iframe.src='https://idyllic-kulfi-7c87be.netlify.app/?referrer='+referrer+'&csp_id='+csp_website_id+'&csp_websites='+csp_websites+'&exp_days='+consent_exp_days+'&csp_event=load';
    iframe.setAttribute('style','display:none !important;');
    document.body.appendChild(iframe);

    window.addEventListener('message', function (event) {
      // Verify the message's origin before trusting it.
      console.log('event.origin: '+event.origin);
      if (event.origin === 'https://idyllic-kulfi-7c87be.netlify.app') {
        // Handle message from a valid domain.
        if (event.data === 'request new consent') {
            console.log('show consent solution');
        }
        else {
            console.log('test: '+event.data);
            document.getElementById('dataRetrieved').textContent = event.data;
            localStorage.setItem('consent_'+csp_website_id,event.data);
        }
      }
      else {
        console.error('evil domain');
      }
    });


    /* REWRITE FOR ONETRUST */
    let updateDeclineAll = document.getElementById('updateDeclineAll');
    updateDeclineAll.addEventListener('click', function(event){
        event.preventDefault();
        
        let referrer = document.location.href;
        let csp_id = '123123';
        let csp_websites = JSON.stringify(['sbackp.com','sbackp.dk']);
        let exp_days = 180;
        
        consents_approved = JSON.stringify([]);
        consents_denied = JSON.stringify(['necessary','statistics','marketing','functional']);
        
        let iframe = document.getElementsByTagName('iframe')[0];
        iframe.src='https://idyllic-kulfi-7c87be.netlify.app/?referrer='+referrer+'&csp_id='+csp_id+'&csp_websites='+csp_websites+'&exp_days='+exp_days+'&csp_event=updateDeclineAll';
    });

    let updateAcceptAll = document.getElementById('updateAcceptAll');
    updateAcceptAll.addEventListener('click', function(event){
        event.preventDefault();
        
        let referrer = document.location.href;
        let csp_id = '123123';
        let csp_websites = JSON.stringify(['sbackp.com','sbackp.dk']);
        let exp_days = 180;

        consents_approved = JSON.stringify(['necessary','statistics','marketing','functional']);
        consents_denied = JSON.stringify([]);

        let iframe = document.getElementsByTagName('iframe')[0];
        iframe.src='https://idyllic-kulfi-7c87be.netlify.app/?referrer='+referrer+'&csp_id='+csp_id+'&csp_websites='+csp_websites+'&exp_days='+exp_days+'&csp_event=updateAcceptAll';
    });

    let updateSelected = document.getElementById('updateSelected');
    updateSelected.addEventListener('click', function(event){
        event.preventDefault();
        
        let referrer = document.location.href;
        let csp_id = '123123';
        let csp_websites = JSON.stringify(['sbackp.com','sbackp.dk']);
        let exp_days = 180;

        consents_approved = JSON.stringify(['necessary','marketing','functional']);
        consents_denied = JSON.stringify(['statistics']);

        let iframe = document.getElementsByTagName('iframe')[0];
        iframe.src='https://idyllic-kulfi-7c87be.netlify.app/?referrer='+referrer+'&csp_id='+csp_id+'&csp_websites='+csp_websites+'&exp_days='+exp_days+'&csp_event=updateSelected&consents_approved='+consents_approved+'&consents_denied='+consents_denied;
    });

    /* REWRITE FOR ONETRUST */
  })();
  
  </script>
