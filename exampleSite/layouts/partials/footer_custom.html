<!--
If you want to include any custom html just before </body>, put it in this file.
Or you can delete these file if you don't need it.
-->
<!-- for example, you could include some js libraries:
<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.19.1/vis.js" integrity="sha256-HdIuWBZj4eftihsoDCJoMYjZi6aNVaw7YlUpzKT3ZxI=" crossorigin="anonymous"></script>
-->
  <h1 id="title">Parent Site</h1>
  <div>
    <h3>Data received from <em id="messageOrigin">...</em>:</h3>
    <pre id="dataRetrieved"></pre>
  </div>

  <div id="iframeContainer">
    <h3>iFrame from other site (would likely be hidden in a real product):</h3>
    <!--<iframe src='https://idyllic-kulfi-7c87be.netlify.app/?referrer=https://sbackp.com' width = '500px' height = '100px'></iframe>-->
  </div>

  <form>
    <button id="updateIframe">update iframe</button>
  </form>

  <script>
    (function () {
      
      
      // The values needed for the iframe to set or update consent
      let referrer = document.location.href;
      let csp_website_id = 'test123123';
      let csp_websites = ['sbackp.com','sbackp.dk'].join(',');
      
      // Create the iframe to communicate with.
      let iframeContainer = document.getElementById('iframeContainer');
      let iframe = document.createElement('iframe');

      iframe.src='https://idyllic-kulfi-7c87be.netlify.app/?referrer='+referrer+'&csp_website_id='+csp_website_id+'&csp_websites='+csp_websites;;
      iframe.width='500px';
      iframe.height='100px';
      iframeContainer.appendChild(iframe);

      window.addEventListener('message', function (event) {
        // Verify the message's origin before trusting it.
        if (event.origin !== 'https://idyllic-kulfi-7c87be.netlify.app') {
          // Handle message from an evil domain.
          alert('Message event received from bad origin');
        }
        else {
          // Handle message from a valid domain.
          document.getElementById('dataRetrieved').textContent = event.data;
          document.getElementById('messageOrigin').textContent = event.origin;
        }
      });

      let updateiframe = document.getElementById('updateIframe');
      updateiframe.addEventListener('click', function(event) {
        event.preventDefault();
        iframe.src = iframe.src + '&test=testtest';
      })
    })();

    /*
    (function () {
      var title = document.getElementById('title');
      var otherParentLink = document.getElementById('otherParentLink');
      var isGood = window.location.host === 'https://sbackp.com';
      title.textContent = (isGood ? '' : 'Evil ') + 'Parent Site'
      otherParentLink.innerHTML = [
        '<a href="http://',
        isGood ? 'evil-' : '',
        'sbackp.com">Try ',
        isGood ? 'Evil' : 'Good',
        ' Parent</a>'
      ].join('');
    })();
    */
  
  console.log('test');
  </script>
